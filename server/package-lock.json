const express = require('express');
const path = require('path');
const app = express();
const PORT = process.env.PORT || 3000;  // Zeabur 会自动分配端口

// 中间件
app.use(express.json());
app.use(express.static(path.join(__dirname, '../public')));

// 模拟数据存储（实际项目应该用数据库）
let orders = [];

// API 路由
app.get('/api/health', (req, res) => {
    res.json({ status: 'ok', message: '情侣厨房服务器运行正常' });
});

app.get('/api/menu', (req, res) => {
    const menu = [
        { id: 1, name: "爱心煎蛋", category: "breakfast", time: 5, emoji: "🍳", difficulty: "★☆☆☆☆" },
        { id: 2, name: "甜蜜三明治", category: "breakfast", time: 10, emoji: "🥪", difficulty: "★☆☆☆☆" },
        { id: 3, name: "阳光沙拉", category: "lunch", time: 15, emoji: "🥗", difficulty: "★★☆☆☆" }
    ];
    res.json(menu);
});

app.post('/api/order', (req, res) => {
    const order = {
        id: Date.now(),
        ...req.body,
        status: 'waiting',
        createdAt: new Date().toISOString()
    };
    orders.push(order);
    res.json({ success: true, orderId: order.id });
});

app.get('/api/orders', (req, res) => {
    res.json(orders);
});

// 前端路由（必须放在最后）
app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../public/index.html'));
});

app.listen(PORT, () => {
    console.log(`🚀 服务器运行在端口 ${PORT}`);
    console.log(`📱 访问地址：http://localhost:${PORT}`);
});